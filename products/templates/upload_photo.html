{% extends "base.html" %}
{% block content %}
<div class="container py-5 text-center">
  <h2 class="text-white mb-4">Sube una imagen para: {{ category }} / {{ subcategory }}</h2>

  {% if views %}
    <form method="POST" enctype="multipart/form-data" action="{% url 'upload_photo' %}">
      {% csrf_token %}
      <input type="hidden" name="category" value="{{ category }}">
      <input type="hidden" name="subcategory" value="{{ subcategory }}">
      <input type="hidden" id="selected_view" name="selected_view" value="">

      <div class="row justify-content-center mb-4">
        {% for view in views %}
          <div class="col-6 col-md-3 mb-3">
            <img src="/{{ view.image }}" alt="{{ view.name }}"
                 class="img-thumbnail selectable"
                 style="cursor:pointer;"
                 onclick="selectView('{{ view.name }}', this)">
          </div>
        {% endfor %}
      </div>

      <div class="mb-3">
        <input type="file" name="photo" accept="image/*" required class="form-control">
      </div>
      <button type="submit" class="btn btn-success">Procesar imagen</button>
    </form>
  {% else %}
    <p class="text-white">No hay vistas disponibles para esta subcategor√≠a.</p>
  {% endif %}

  <a href="{% url 'select_subcategory' category %}" class="btn btn-secondary mt-4">Volver</a>
</div>

<script>
  function selectView(name, element) {
    document.querySelectorAll('.selectable').forEach(el => el.style.border = '3px solid transparent');
    element.style.border = '3px solid lime';
    document.getElementById('selected_view').value = name;
  }
</script>
{% endblock %}
