{% extends "base.html" %}
{% load static %}

{% block title %}Generar foto – {{ subcategory.category.name }} / {{ subcategory.name }}{% endblock %}

{% block content %}
<div class="container py-4">
  <h1 class="mb-3">Generar foto – {{ subcategory.category.name }} / {{ subcategory.name }}</h1>

  <form method="post" enctype="multipart/form-data" class="mt-3">
    {% csrf_token %}

    <!-- Prompt -->
    <div class="mb-3">
      <label class="form-label">Prompt principal</label>
      <textarea name="final_prompt" class="form-control" rows="3"
                placeholder="Describe cómo quieres la imagen…">{{ final_prompt }}</textarea>
    </div>

    <!-- Vista elegida (solo lectura) -->
    <div class="mb-3">
      <label class="form-label">Vista elegida</label>
      <input type="text" class="form-control" value="{{ viewopt.name }}" disabled>
      <!-- valores reales que necesita la vista en el POST -->
      <input type="hidden" name="subcategory_id" value="{{ subcategory.id }}">
      <input type="hidden" name="view_id" value="{{ viewopt.id }}">
    </div>

    <!-- Imagen base del usuario -->
    <div class="mb-3">
      <label class="form-label">Imagen base (opcional, JPG/PNG/WebP)</label>
      <input type="file" name="product_photo" class="form-control"
             accept="image/png,image/jpeg,image/webp">
    </div>

    <!-- Referencia del master prompt (si existe) -->
    {% if master_prompt_photo %}
      <div class="mb-3">
        <label class="form-label">Foto de referencia (plantilla)</label><br>
        <img src="{{ master_prompt_photo.url }}" alt="Referencia"
             style="max-width:280px;height:auto;border:1px solid #333;border-radius:6px;">
      </div>
    {% endif %}

    <button type="submit" class="btn btn-primary">Generar</button>
    <a href="{% url 'view_options' subcategory.id %}"
       class="btn btn-outline-secondary ms-2">Volver</a>
  </form>

  <!-- Imagen generada -->
  {% if generated_image_url %}
    <div class="mt-5 text-center">
      <h3>Resultado generado</h3>
      <img src="{{ generated_image_url }}" alt="Imagen generada"
           style="max-width:100%;height:auto;border:2px solid #444;border-radius:10px;">
      <div class="mt-3">
        <a href="{{ generated_image_url }}" class="btn btn-success" download>
          Descargar imagen
        </a>
      </div>
    </div>
  {% endif %}

</div>
{% endblock %}
