
<!doctype html><meta charset="utf-8">
<h1>2) Subir imagen</h1>

{% if selection %}
<p><strong>Selección:</strong> {{ selection }}</p>
{% endif %}

{% if assets %}
  <h3>Vistas disponibles (elige una)</h3>
  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:12px;max-width:980px">
      {% for a in assets %}
        <label style="border:1px solid #ddd;padding:8px;display:block;text-align:center;cursor:pointer">
          <img src="{{ a.thumb_url }}" style="max-width:100%;height:120px;object-fit:contain" alt="miniatura">
          <div style="margin-top:6px">
            <input type="radio" name="asset_choice" value="{{ a.id }}" onclick="document.getElementById('id_asset_id').value=this.value">
            usar esta vista
          </div>
        </label>
      {% endfor %}
    </div>

    {{ form.asset_id }}  {# hidden #}

    <hr>
    <p><strong>O sube una imagen propia:</strong></p>
    {{ form.image }}

    <div style="margin-top:12px">
      <button type="submit">Procesar</button>
    </div>
  </form>
{% else %}
  <p style="color:#666">No se encontraron miniaturas para esta selección.  
  Sube una imagen o añade vistas en <code>products/lineas/&lt;Categoria&gt;_&lt;Subcategoria&gt;/</code>.</p>

  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    {{ form.image }}
    {{ form.asset_id }}
    <div style="margin-top:12px">
      <button type="submit">Procesar</button>
    </div>
  </form>
{% endif %}

<p style="margin-top:16px"><a href="{% url 'select_category' %}">Volver</a></p>
