{% extends 'base.html' %}
{% block content %}
<h2 class="text-center mb-4">✨ Transforma tu imagen con Phomagic ✨</h2>

<div class="card shadow p-4">
    <div class="mb-3">
        <label for="category" class="form-label fw-bold">Categoría</label>
        <select id="category" class="form-select">
            <option value="">Selecciona una categoría...</option>
            {% for cat in categories %}
            <option value="{{ cat.id }}">{{ cat.name }}</option>
            {% endfor %}
        </select>
    </div>

    <div class="mb-3">
        <label for="subcategory" class="form-label fw-bold">Subcategoría</label>
        <select id="subcategory" class="form-select" disabled>
            <option value="">Selecciona una subcategoría...</option>
        </select>
    </div>

    <div id="views-container" class="row g-3 mt-3"></div>
</div>
{% endblock %}

{% block scripts %}
<script>
$(document).ready(function() {
    $("#category").change(function() {
        var categoryId = $(this).val();
        $("#subcategory").prop("disabled", true).html('<option>Cargando...</option>');
        $("#views-container").html('');

        if (categoryId) {
            $.get("/load_subcategories/", { category_id: categoryId }, function(data) {
                let options = '<option value="">Selecciona una subcategoría...</option>';
                data.forEach(sub => {
                    options += `<option value="${sub.id}">${sub.name}</option>`;
                });
                $("#subcategory").html(options).prop("disabled", false);
            });
        }
    });

    $("#subcategory").change(function() {
        var subcatId = $(this).val();
        $("#views-container").html("<p class='text-center text-muted'>Cargando vistas...</p>");
        if (subcatId) {
            $.get("/load_views/", { subcategory_id: subcatId }, function(data) {
                let html = '';
                data.forEach(view => {
                    html += `
                        <div class="col-md-3 text-center">
                            <div class="card shadow-sm">
                                <img src="/media/${view.thumbnail}" class="card-img-top" style="height:150px; object-fit:cover;">
                                <div class="card-body">
                                    <h6>${view.name}</h6>
                                    <a href="/upload/${view.id}/" class="btn btn-primary btn-sm">Seleccionar</a>
                                </div>
                            </div>
                        </div>`;
                });
                $("#views-container").html(html);
            });
        }
    });
});
</script>
{% endblock %}
